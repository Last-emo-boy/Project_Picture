<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Face Recognition Upload</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        input, button { margin-top: 10px; }
        #results { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Upload Image for Face Recognition</h1>
    <input type="file" id="imageInput" accept="image/*">
    <button onclick="uploadImage()">Upload and Recognize</button>
    <div id="results"></div>

    <script>
        function uploadImage() {
            const imageInput = document.getElementById('imageInput');
            const formData = new FormData();
            formData.append("file", imageInput.files[0]);

            fetch('http://localhost:5000/upload', {
                method: 'POST',
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                displayResults(data);
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('results').innerHTML = 'Failed to upload image.';
            });
        }

        function displayResults(data) {
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = '';

            if (data.faces && data.faces.length > 0) {
                data.faces.forEach(face => {
                    const faceDiv = document.createElement('div');
                    faceDiv.innerHTML = `Face Detected: <img src="${face.path}" style="width: 100px;"><br>`;

                    if (face.new) {
                        const nameLabel = document.createElement('label');
                        nameLabel.innerHTML = 'Enter name for the new face: ';
                        const nameInput = document.createElement('input');
                        nameInput.type = 'text';
                        const saveButton = document.createElement('button');
                        saveButton.textContent = 'Save';
                        saveButton.onclick = () => saveFaceName(face.uuid, nameInput.value);

                        faceDiv.appendChild(nameLabel);
                        faceDiv.appendChild(nameInput);
                        faceDiv.appendChild(saveButton);
                    }

                    resultsContainer.appendChild(faceDiv);
                });
            } else {
                resultsContainer.innerHTML = 'No faces detected or image already uploaded.';
            }
        }

        function saveFaceName(faceUuid, name) {
            fetch('http://localhost:5000/tag_face', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ face_id: faceUuid, tag: name }),
            })
            .then(response => response.json())
            .then(data => {
                alert('Face name saved successfully!');
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to save face name.');
            });
        }
    </script>
</body>
</html>
